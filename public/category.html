<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Category – AI News Hub</title>
  <link rel="stylesheet" href="/resources/site.css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    (function(){
      const root = document.documentElement;
      const saved = localStorage.getItem('theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const theme = saved || (prefersDark ? 'dark' : 'light');
      root.dataset.theme = theme;
      root.classList.toggle('dark', theme === 'dark');
      window.toggleTheme = function(){
        const next = root.dataset.theme === 'dark' ? 'light' : 'dark';
        root.dataset.theme = next;
        root.classList.toggle('dark', next === 'dark');
        localStorage.setItem('theme', next);
      };
    })();
  </script>
</head>
<body class="bg-light dark:bg-dark text-slate-900 dark:text-slate-100">
  <header>
    <div id="site-header"></div>
  </header>
  <script src="/scripts/include-header.js" defer></script>
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      await window.mountHeader('#site-header');
      window.initHeaderAuth();
    });
  </script>

  <main class="max-w-6xl mx-auto p-4 sm:p-6">
    <h1 id="catTitle" class="text-3xl font-bold mb-1">Category</h1>
    <p id="catDesc" class="text-slate-500 dark:text-slate-400 mb-6"></p>

    <div id="posts" class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3"></div>
    <p id="empty" class="hidden text-slate-500 dark:text-slate-400 mt-4">No posts found.</p>
  </main>

  <footer class="bg-white dark:bg-slate-900 border-t border-slate-200 dark:border-slate-800 mt-12">
    <div class="max-w-7xl mx-auto p-8">
      <a href="/" class="brand" aria-label="AI News Hub — Home">
        <img class="brand__img" src="/assets/brand/logo-full.svg" alt="AI News Hub logo">
        <span class="brand__text hidden sm:inline">AI News Hub</span>
      </a>
    </div>
  </footer>

  <script>
    const TAG_MAP = {
      'openai-news': { title: 'OpenAI News', desc: 'Latest official updates and announcements from OpenAI.' },
      'chatgpt-updates': { title: 'ChatGPT Updates', desc: 'New features, fixes, and tips for ChatGPT.' },
      'ai-industry': { title: 'AI Industry News', desc: 'Broader AI ecosystem: companies, products, policy.' },
      'research-innovation': { title: 'Research & Innovation', desc: 'Papers, breakthroughs, and experimental projects.' }
    };

    function getTag() {
      const params = new URLSearchParams(location.search);
      return (params.get('tag') || '').toLowerCase();
    }

    async function loadPosts() {
      const tag = getTag();
      const meta = TAG_MAP[tag] || { title: 'Category', desc: '' };
      document.title = meta.title + ' – AI News Hub';
      document.getElementById('catTitle').textContent = meta.title;
      document.getElementById('catDesc').textContent = meta.desc;

      const res = await fetch('/data/posts.json', { cache: 'no-store' });
      const all = await res.json();
      const posts = all.filter(p => (p.tags || []).map(t => t.toLowerCase()).includes(tag));

      const wrap = document.getElementById('posts');
      if (!posts.length) {
        document.getElementById('empty').classList.remove('hidden');
        return;
      }

      wrap.innerHTML = posts.map(p => `
        <article class="rounded-xl border border-slate-200 dark:border-slate-800 bg-white/60 dark:bg-slate-900/60 backdrop-blur p-4">
          ${p.image ? `<img src="${p.image}" alt="" class="rounded-lg mb-3 w-full h-40 object-cover">` : ''}
          <div class="text-xs text-slate-500 mb-1">${p.date}</div>
          <h2 class="text-lg font-semibold mb-2">
            <a class="hover:underline" href="/posts/${p.slug}.html">${p.title}</a>
          </h2>
          <p class="text-slate-600 dark:text-slate-300 mb-3">${p.excerpt || ''}</p>
          <div class="flex flex-wrap gap-2">
            ${(p.tags||[]).map(t=>`<span class="px-2 py-0.5 rounded-full text-xs border border-slate-300 dark:border-slate-700">${t}</span>`).join('')}
          </div>
        </article>
      `).join('');
    }
    loadPosts();
  </script>
</body>
</html>
